<HarmonyScreen>:
    orientation: 'horizontal'
    padding: 15
    spacing: 15
    canvas.before:
        Color:
            rgba: 0.95, 0.95, 0.96, 1  # Fundo cinza claro
        Rectangle:
            pos: self.pos
            size: self.size

    # Coluna principal (70% da largura)
    BoxLayout:
        orientation: 'vertical'
        size_hint_x: 0.7
        spacing: 15

        # Linha do título com botões
        BoxLayout:
            size_hint_y: None
            height: 55
            spacing: 10
            
            # Título do projeto (agora ocupa 60% da largura)
            TextInput:
                id: project_title_input
                hint_text: "Título do projeto"
                hint_text_color: 0.6, 0.6, 0.6, 1
                font_size: 18
                multiline: False
                foreground_color: 0.2, 0.2, 0.2, 1
                background_color: 1, 1, 1, 1
                cursor_color: 0.1, 0.5, 0.8, 1
                on_text_validate: root.ids.lyrics_input.focus = True
            
            # Botão Salvar (20% da largura)
            Button:
                text: "SALVAR"
                size_hint_x: 0.2
                background_normal: ''
                background_color: 0.2, 0.7, 0.4, 1  # Verde
                color: 1, 1, 1, 1
                bold: True
                font_size: '14sp'
                on_press: root.save_project()
            
            # Botão Carregar (20% da largura)
            Button:
                text: "CARREGAR"
                size_hint_x: 0.2
                background_normal: ''
                background_color: 0.4, 0.5, 0.9, 1  # Azul mais claro
                color: 1, 1, 1, 1
                bold: True
                font_size: '14sp'
                on_press: root.load_project()

        # Área de edição da letra
        TextInput:
            id: lyrics_input
            hint_text: "Digite ou cole a letra com acordes no formato [Am]"
            hint_text_color: 0.6, 0.6, 0.6, 1
            size_hint_y: 0.4
            multiline: True
            font_size: 16
            foreground_color: 0.2, 0.2, 0.2, 1
            background_color: 1, 1, 1, 1
            cursor_color: 0.1, 0.5, 0.8, 1
            on_text: root.on_text_change(*args)

        # Inserção de acordes
        BoxLayout:
            size_hint_y: None
            height: 55
            spacing: 10

            TextInput:
                id: chord_input
                hint_text: "Acorde (ex: Am, C7)"
                hint_text_color: 0.6, 0.6, 0.6, 1
                multiline: False
                foreground_color: 0.2, 0.2, 0.2, 1
                background_color: 1, 1, 1, 1
                cursor_color: 0.1, 0.5, 0.8, 1
                on_text_validate: root.insert_chord_tag()

            Button:
                text: "Inserir acorde"
                size_hint_x: 0.4
                background_normal: ''
                background_color: 0.1, 0.5, 0.8, 1
                color: 1, 1, 1, 1
                bold: True
                on_press: root.insert_chord_tag()

        # Pré-visualização HORIZONTAL (cifra + análise)
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: 0.45
            spacing: 15

            # Cifra (esquerda)
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: 0.6
                canvas.before:
                    Color:
                        rgba: 1, 1, 1, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size

                Label:
                    text: "CIFRA"
                    size_hint_y: None
                    height: 35
                    font_size: '16sp'
                    bold: True
                    color: 0.1, 0.5, 0.8, 1
                    canvas.before:
                        Color:
                            rgba: 0.9, 0.94, 0.98, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size

                ScrollView:
                    bar_width: 10
                    bar_color: 0.1, 0.5, 0.8, 0.7
                    bar_inactive_color: 0.1, 0.5, 0.8, 0.4

                    Label:
                        id: cifra_preview
                        markup: True
                        text_size: self.width, None
                        size_hint_y: None
                        height: self.texture_size[1]
                        font_size: 16
                        padding: 10, 10
                        halign: 'left'
                        valign: 'top'
                        color: 0.2, 0.2, 0.2, 1

            # Análise (direita)
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: 0.4
                canvas.before:
                    Color:
                        rgba: 1, 1, 1, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size

                Label:
                    text: "ANÁLISE HARMÔNICA"
                    size_hint_y: None
                    height: 35
                    font_size: '16sp'
                    bold: True
                    color: 0.1, 0.5, 0.8, 1
                    canvas.before:
                        Color:
                            rgba: 0.9, 0.94, 0.98, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size

                ScrollView:
                    bar_width: 10
                    bar_color: 0.1, 0.5, 0.8, 0.7
                    bar_inactive_color: 0.1, 0.5, 0.8, 0.4

                    Label:
                        id: metadata_preview
                        markup: True
                        text_size: self.width, None
                        size_hint_y: None
                        height: self.texture_size[1]
                        font_size: 14
                        padding: 10, 10
                        halign: 'left'
                        valign: 'top'
                        color: 0.2, 0.2, 0.2, 1

    # Coluna lateral (30% da largura)
    BoxLayout:
        orientation: 'vertical'
        size_hint_x: 0.3
        spacing: 15

        # Lista de acordes
        Label:
            text: "ACORDES NA MÚSICA"
            font_size: '16sp'
            size_hint_y: None
            height: 35
            bold: True
            color: 0.1, 0.5, 0.8, 1
            canvas.before:
                Color:
                    rgba: 0.9, 0.94, 0.98, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        ScrollView:
            size_hint_y: 0.35
            bar_width: 10
            bar_color: 0.1, 0.5, 0.8, 0.7
            bar_inactive_color: 0.1, 0.5, 0.8, 0.4

            GridLayout:
                id: chord_list
                cols: 1
                size_hint_y: None
                height: self.minimum_height
                spacing: 5
                padding: 10
                canvas.before:
                    Color:
                        rgba: 1, 1, 1, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size

        # Acorde selecionado
        Label:
            id: selected_chord_label
            text: "[i]Nenhum acorde selecionado[/i]"
            markup: True
            size_hint_y: None
            height: 40
            color: 0.4, 0.4, 0.4, 1
            canvas.before:
                Color:
                    rgba: 0.98, 0.98, 0.98, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        # Campos de edição
        TextInput:
            id: degree_input
            hint_text: "Grau harmônico (ex: I, ii, V7)"
            hint_text_color: 0.6, 0.6, 0.6, 1
            size_hint_y: None
            height: 55
            multiline: False
            foreground_color: 0.2, 0.2, 0.2, 1
            background_color: 1, 1, 1, 1
            cursor_color: 0.1, 0.5, 0.8, 1

        TextInput:
            id: comment_input
            hint_text: "Análise/comentário"
            hint_text_color: 0.6, 0.6, 0.6, 1
            size_hint_y: 0.2
            foreground_color: 0.2, 0.2, 0.2, 1
            background_color: 1, 1, 1, 1
            cursor_color: 0.1, 0.5, 0.8, 1

        # Botões de ação
        BoxLayout:
            size_hint_y: None
            height: 55
            spacing: 10

            Button:
                text: "Atualizar"
                background_normal: ''
                background_color: 0.3, 0.6, 0.9, 1
                color: 1, 1, 1, 1
                bold: True
                on_press: root.update_metadata()

            Button:
                text: "Limpar"
                background_normal: ''
                background_color: 0.9, 0.5, 0.5, 1
                color: 1, 1, 1, 1
                bold: True
                on_press: root.clear_metadata_fields()