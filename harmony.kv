# -*- coding: utf-8 -*-
# Kivy Language (KV) file for the Harmonauta application - Versão Melhorada

<HarmonyScreen>:
    project_title_input: project_title_input
    project_description_input: project_description_input
    project_key_input: project_key_input
    lyrics_input: lyrics_input
    chord_input: chord_input
    degree_input: degree_input
    comment_input: comment_input
    cifra_preview: cifra_preview
    metadata_preview: metadata_preview
    chord_list: chord_list
    selected_chord_label: selected_chord_label

    orientation: 'vertical'
    padding: '0dp'
    spacing: '0dp'
    canvas.before:
        Color:
            rgba: 0.98, 0.98, 0.98, 1
        Rectangle:
            pos: self.pos
            size: self.size

    ScrollView:
        size_hint: (1, 1)
        do_scroll_x: False
        bar_width: dp(12)
        bar_color: 0.1, 0.5, 0.8, 0.9
        scroll_type: ['bars', 'content']
        effect_cls: 'ScrollEffect'
        
        GridLayout:
            cols: 1
            size_hint_y: None
            height: self.minimum_height
            spacing: dp(25)
            padding: [dp(20), dp(20), dp(20), dp(20)]

            # Card de informações do projeto - Melhorado
            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(15)
                canvas.before:
                    Color:
                        rgba: 1, 1, 1, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(15), dp(15), dp(15), dp(15)]
                    Color:
                        rgba: 0.85, 0.85, 0.85, 0.5
                    Line:
                        rounded_rectangle: (self.x, self.y, self.width, self.height, dp(15))
                        width: dp(1.5)
                padding: [dp(20), dp(20), dp(20), dp(20)]

                Label:
                    text: "INFORMAÇÕES DO PROJETO"
                    size_hint_y: None
                    height: dp(40)
                    font_size: '20sp'
                    bold: True
                    color: 0.2, 0.2, 0.2, 1
                    halign: 'left'
                    valign: 'middle'
                    text_size: self.width, None

                GridLayout:
                    cols: 1
                    spacing: dp(12)
                    size_hint_y: None
                    height: self.minimum_height

                    TextInput:
                        id: project_title_input
                        hint_text: "Nome da música"
                        font_size: '18sp'
                        size_hint_y: None
                        height: dp(60)
                        multiline: False
                        padding: [dp(15), dp(15), dp(15), dp(15)]
                        background_color: 0.96, 0.96, 0.96, 1
                        foreground_color: 0, 0, 0, 1  # Alterado para preto
                        hint_text_color: 0.3, 0.3, 0.3, 1  # Alterado para branco
                        cursor_color: 0.1, 0.5, 0.8, 1
                        selection_color: 0.1, 0.5, 0.8, 0.3
                        write_tab: False

                    GridLayout:
                        cols: 2
                        spacing: dp(12)
                        size_hint_y: None
                        height: dp(60)

                        TextInput:
                            id: project_description_input
                            hint_text: "Compositor"
                            font_size: '18sp'
                            multiline: False
                            padding: [dp(15), dp(15), dp(15), dp(15)]
                            background_color: 0.96, 0.96, 0.96, 1
                            foreground_color: 0, 0, 0, 1  # Alterado para preto
                            hint_text_color: 0.3, 0.3, 0.3, 1  # Alterado para branco
                            cursor_color: 0.1, 0.5, 0.8, 1
                            selection_color: 0.1, 0.5, 0.8, 0.3
                            write_tab: False

                        TextInput:
                            id: project_key_input
                            hint_text: "Tonalidade"
                            font_size: '18sp'
                            multiline: False
                            padding: [dp(15), dp(15), dp(15), dp(15)]
                            background_color: 0.96, 0.96, 0.96, 1
                            foreground_color: 0, 0, 0, 1  # Alterado para preto
                            hint_text_color: 0.3, 0.3, 0.3, 1  # Alterado para branco
                            cursor_color: 0.1, 0.5, 0.8, 1
                            selection_color: 0.1, 0.5, 0.8, 0.3
                            write_tab: False

            # Card de botões de ação - Melhorado
            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height
                canvas.before:
                    Color:
                        rgba: 1, 1, 1, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(15), dp(15), dp(15), dp(15)]
                    Color:
                        rgba: 0.85, 0.85, 0.85, 0.5
                    Line:
                        rounded_rectangle: (self.x, self.y, self.width, self.height, dp(15))
                        width: dp(1.5)
                padding: [dp(20), dp(20), dp(20), dp(20)]
                spacing: dp(15)

                Label:
                    text: "AÇÕES RÁPIDAS"
                    size_hint_y: None
                    height: dp(40)
                    font_size: '20sp'
                    bold: True
                    color: 0.2, 0.2, 0.2, 1
                    halign: 'left'
                    valign: 'middle'
                    text_size: self.width, None

                GridLayout:
                    cols: 2
                    rows: 2
                    spacing: dp(12)
                    size_hint_y: None
                    height: dp(120)

                    Button:
                        text: "SALVAR"
                        font_size: '17sp'
                        background_normal: ''
                        background_color: 0.2, 0.75, 0.45, 1
                        color: 1, 1, 1, 1
                        bold: True
                        on_release: root.save_project()
                        canvas.before:
                            Color:
                                rgba: self.background_color
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [dp(10), dp(10), dp(10), dp(10)]

                    Button:
                        text: "CARREGAR"
                        font_size: '17sp'
                        background_normal: ''
                        background_color: 0.1, 0.55, 0.85, 1
                        color: 1, 1, 1, 1
                        bold: True
                        on_release: root.load_project()
                        canvas.before:
                            Color:
                                rgba: self.background_color
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [dp(10), dp(10), dp(10), dp(10)]

                    Button:
                        text: "RESETAR"
                        font_size: '17sp'
                        background_normal: ''
                        background_color: 0.95, 0.35, 0.35, 1
                        color: 1, 1, 1, 1
                        bold: True
                        on_release: root.reset_all_fields()
                        canvas.before:
                            Color:
                                rgba: self.background_color
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [dp(10), dp(10), dp(10), dp(10)]
                    
                    Button:
                        text: "BUSCAR LETRA"
                        font_size: '16sp'
                        background_normal: ''
                        background_color: 0.95, 0.65, 0.25, 1
                        color: 1, 1, 1, 1
                        bold: True
                        on_release: root.fetch_lyrics_from_letras()
                        canvas.before:
                            Color:
                                rgba: self.background_color
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [dp(10), dp(10), dp(10), dp(10)]

            # Card principal de edição - Melhorado
            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height # Ajustado para se adaptar ao conteúdo
                canvas.before:
                    Color:
                        rgba: 1, 1, 1, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(15), dp(15), dp(15), dp(15)]
                    Color:
                        rgba: 0.85, 0.85, 0.85, 0.5
                    Line:
                        rounded_rectangle: (self.x, self.y, self.width, self.height, dp(15))
                        width: dp(1.5)
                padding: [dp(20), dp(20), dp(20), dp(20)]
                spacing: dp(15)

                Label:
                    text: "EDITOR DE CIFRAS"
                    size_hint_y: None
                    height: dp(40)
                    font_size: '20sp'
                    bold: True
                    color: 0.2, 0.2, 0.2, 1
                    halign: 'left'
                    valign: 'middle'
                    text_size: self.width, None

                BoxLayout:
                    orientation: 'vertical'
                    spacing: dp(15)
                    size_hint_y: None
                    height: self.minimum_height # Ajusta a altura automaticamente

                    # Área de texto principal (100% horizontal)
                    BoxLayout:
                        orientation: 'vertical'
                        size_hint_x: 1
                        spacing: dp(10)
                        size_hint_y: None
                        height: dp(300) # Altura fixa para a área de texto

                        Label:
                            text: "Letra com acordes"
                            size_hint_y: None
                            height: dp(35)
                            font_size: '16sp'
                            color: 0.4, 0.4, 0.4, 1
                            halign: 'left'
                            valign: 'middle'
                            text_size: self.width, None

                        ScrollView:
                            scroll_type: ['bars', 'content']
                            bar_width: dp(10)
                            bar_color: 0.1, 0.5, 0.8, 0.7
                            canvas.before:
                                Color:
                                    rgba: 0.96, 0.96, 0.96, 1
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(12), dp(12), dp(12), dp(12)]
                            TextInput:
                                id: lyrics_input
                                hint_text: "Digite a letra com acordes no formato [Am]...\n\nExemplo:\n[C]Imagine there's no [F]heaven\n[Am]It's easy if you [C]try"
                                size_hint_y: None
                                height: max(self.parent.height, self.minimum_height)
                                font_size: '17sp'
                                multiline: True
                                padding: [dp(15), dp(15), dp(15), dp(15)]
                                background_color: 0.96, 0.96, 0.96, 1
                                foreground_color: 0, 0, 0, 1
                                hint_text_color: 0.3, 0.3, 0.3, 1
                                cursor_color: 0.1, 0.5, 0.8, 1
                                selection_color: 0.1, 0.5, 0.8, 0.3
                                on_text: root.on_text_change(*args)

                    # Painel de controles (100% horizontal)
                    BoxLayout:
                        orientation: 'vertical'
                        size_hint_x: 1
                        spacing: dp(12)
                        size_hint_y: None
                        height: self.minimum_height
                        canvas.before:
                            Color:
                                rgba: 0.97, 0.97, 0.97, 1
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [dp(12), dp(12), dp(12), dp(12)]
                        padding: [dp(15), dp(15), dp(15), dp(15)]

                        Label:
                            text: "Inserir Acorde"
                            size_hint_y: None
                            height: dp(40)
                            font_size: '18sp'
                            bold: True
                            color: 0.2, 0.2, 0.2, 1
                            halign: 'center'
                            valign: 'middle'
                            text_size: self.width, None

                        # Campo de acorde
                        BoxLayout:
                            orientation: 'vertical'
                            size_hint_y: None
                            height: dp(90)
                            spacing: dp(8)

                            Label:
                                text: "Acorde"
                                size_hint_y: None
                                height: dp(30)
                                font_size: '15sp'
                                color: 0.4, 0.4, 0.4, 1
                                halign: 'left'
                                valign: 'middle'
                                text_size: self.width, None

                            TextInput:
                                id: chord_input
                                hint_text: "Ex: Am, C7, Dm/F"
                                font_size: '17sp'
                                multiline: False
                                padding: [dp(15), dp(15), dp(15), dp(15)]
                                size_hint_y: None
                                height: dp(50)
                                background_color: 0.96, 0.96, 0.96, 1
                                foreground_color: 0, 0, 0, 1
                                hint_text_color: 0.3, 0.3, 0.3, 1
                                cursor_color: 0.1, 0.5, 0.8, 1
                                selection_color: 0.1, 0.5, 0.8, 0.3

                        # Campo de grau
                        BoxLayout:
                            orientation: 'vertical'
                            size_hint_y: None
                            height: dp(90)
                            spacing: dp(8)

                            Label:
                                text: "Grau Harmônico"
                                size_hint_y: None
                                height: dp(30)
                                font_size: '15sp'
                                color: 0.4, 0.4, 0.4, 1
                                halign: 'left'
                                valign: 'middle'
                                text_size: self.width, None

                            TextInput:
                                id: degree_input
                                hint_text: "Ex: I, ii, V7, bVII"
                                font_size: '17sp'
                                multiline: False
                                padding: [dp(15), dp(15), dp(15), dp(15)]
                                size_hint_y: None
                                height: dp(50)
                                background_color: 0.96, 0.96, 0.96, 1
                                foreground_color: 0, 0, 0, 1
                                hint_text_color: 0.3, 0.3, 0.3, 1
                                cursor_color: 0.1, 0.5, 0.8, 1
                                selection_color: 0.1, 0.5, 0.8, 0.3

                        # Campo de análise
                        BoxLayout:
                            orientation: 'vertical'
                            size_hint_y: None
                            height: dp(140)
                            spacing: dp(8)

                            Label:
                                text: "Análise Harmônica"
                                size_hint_y: None
                                height: dp(30)
                                font_size: '15sp'
                                color: 0.4, 0.4, 0.4, 1
                                halign: 'left'
                                valign: 'middle'
                                text_size: self.width, None

                            TextInput:
                                id: comment_input
                                hint_text: "Função harmônica, movimento melódico, contexto na progressão..."
                                font_size: '16sp'
                                multiline: True
                                padding: [dp(15), dp(15), dp(15), dp(15)]
                                size_hint_y: None
                                height: dp(100)
                                background_color: 0.96, 0.96, 0.96, 1
                                foreground_color: 0, 0, 0, 1
                                hint_text_color: 0.3, 0.3, 0.3, 1
                                cursor_color: 0.1, 0.5, 0.8, 1
                                selection_color: 0.1, 0.5, 0.8, 0.3

                        # Botões de ação
                        GridLayout:
                            cols: 2
                            spacing: dp(10)
                            size_hint_y: None
                            height: dp(60)

                            Button:
                                text: "INSERIR"
                                font_size: '15sp'
                                background_normal: ''
                                background_color: 0.1, 0.55, 0.85, 1
                                color: 1, 1, 1, 1
                                bold: True
                                on_release: root.insert_chord_tag()
                                canvas.before:
                                    Color:
                                        rgba: self.background_color
                                    RoundedRectangle:
                                        pos: self.pos
                                        size: self.size
                                        radius: [dp(10), dp(10), dp(10), dp(10)]
                            
                            Button:
                                text: "LIMPAR"
                                font_size: '15sp'
                                background_normal: ''
                                background_color: 0.95, 0.45, 0.35, 1
                                color: 1, 1, 1, 1
                                bold: True
                                on_release: root.clear_metadata_fields()
                                canvas.before:
                                    Color:
                                        rgba: self.background_color
                                    RoundedRectangle:
                                        pos: self.pos
                                        size: self.size
                                        radius: [dp(10), dp(10), dp(10), dp(10)]

            # Card de visualização - Melhorado
            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height # Ajustado para se adaptar ao conteúdo
                canvas.before:
                    Color:
                        rgba: 1, 1, 1, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(15), dp(15), dp(15), dp(15)]
                    Color:
                        rgba: 0.85, 0.85, 0.85, 0.5
                    Line:
                        rounded_rectangle: (self.x, self.y, self.width, self.height, dp(15))
                        width: dp(1.5)
                padding: [dp(20), dp(20), dp(20), dp(20)]
                spacing: dp(15)

                Label:
                    text: "PRÉ-VISUALIZAÇÃO"
                    size_hint_y: None
                    height: dp(40)
                    font_size: '20sp'
                    bold: True
                    color: 0.2, 0.2, 0.2, 1
                    halign: 'left'
                    valign: 'middle'
                    text_size: self.width, None

                BoxLayout:
                    orientation: 'vertical'
                    spacing: dp(15)
                    size_hint_y: None
                    height: self.minimum_height # Ajusta a altura automaticamente

                    # Visualização da cifra (100% horizontal)
                    BoxLayout:
                        orientation: 'vertical'
                        size_hint_x: 1
                        spacing: dp(10)
                        size_hint_y: None
                        height: dp(300) # Altura fixa para a visualização da cifra

                        Label:
                            text: "Cifra formatada"
                            size_hint_y: None
                            height: dp(35)
                            font_size: '16sp'
                            color: 0.4, 0.4, 0.4, 1
                            halign: 'left'
                            valign: 'middle'
                            text_size: self.width, None

                        ScrollView:
                            scroll_type: ['bars', 'content']
                            bar_width: dp(10)
                            bar_color: 0.1, 0.5, 0.8, 0.7
                            canvas.before:
                                Color:
                                    rgba: 0.96, 0.96, 0.96, 1
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(12), dp(12), dp(12), dp(12)]
                            Label:
                                id: cifra_preview
                                markup: True
                                size_hint_y: None
                                height: max(dp(250), self.texture_size[1])
                                font_size: '17sp'
                                text_size: self.width - dp(30), None
                                halign: 'left'
                                valign: 'top'
                                padding: [dp(15), dp(15), dp(15), dp(15)]
                                color: 0.15, 0.15, 0.15, 1

                    # Visualização de metadados (100% horizontal)
                    BoxLayout:
                        orientation: 'vertical'
                        size_hint_x: 1
                        spacing: dp(10)
                        size_hint_y: None
                        height: dp(200) # Altura fixa para a visualização da cifra

                        Label:
                            text: "Funções dos acordes"
                            size_hint_y: None
                            height: dp(35)
                            font_size: '16sp'
                            color: 0.4, 0.4, 0.4, 1
                            halign: 'left'
                            valign: 'middle'
                            text_size: self.width, None

                        ScrollView:
                            scroll_type: ['bars', 'content']
                            bar_width: dp(10)
                            bar_color: 0.1, 0.5, 0.8, 0.7
                            canvas.before:
                                Color:
                                    rgba: 0.96, 0.96, 0.96, 1
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(12), dp(12), dp(12), dp(12)]
                            Label:
                                id: metadata_preview
                                markup: True
                                size_hint_y: None
                                height: max(dp(250), self.texture_size[1])
                                font_size: '17sp'
                                text_size: self.width - dp(30), None
                                halign: 'left'
                                valign: 'top'
                                padding: [dp(15), dp(15), dp(15), dp(15)]
                                color: 0.15, 0.15, 0.15, 1

            # Card combinado - Melhorado
            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height # Ajustado para se adaptar ao conteúdo
                spacing: dp(20)
                canvas.before:
                    Color:
                        rgba: 1, 1, 1, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(15), dp(15), dp(15), dp(15)]
                    Color:
                        rgba: 0.85, 0.85, 0.85, 0.5
                    Line:
                        rounded_rectangle: (self.x, self.y, self.width, self.height, dp(15))
                        width: dp(1.5)
                padding: [dp(20), dp(20), dp(20), dp(20)]

                # Lista de acordes (100% horizontal)
                BoxLayout:
                    orientation: 'vertical'
                    size_hint_x: 1
                    spacing: dp(15)
                    size_hint_y: None
                    height: dp(400) # Altura fixa para a lista de acordes

                    Label:
                        text: "LISTA DE ACORDES"
                        size_hint_y: None
                        height: dp(40)
                        font_size: '18sp'
                        bold: True
                        color: 0.2, 0.2, 0.2, 1
                        halign: 'left'
                        valign: 'middle'
                        text_size: self.width, None

                    ScrollView:
                        scroll_type: ['bars', 'content']
                        bar_width: dp(10)
                        bar_color: 0.1, 0.5, 0.8, 0.7
                        canvas.before:
                            Color:
                                rgba: 0.96, 0.96, 0.96, 1
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [dp(12), dp(12), dp(12), dp(12)]
                        
                        GridLayout:
                            id: chord_list
                            cols: 1
                            size_hint_y: None
                            height: self.minimum_height
                            spacing: dp(12)
                            padding: [dp(15), dp(15), dp(15), dp(15)]

                                    # Painel integrado (100% horizontal)
                    BoxLayout:
                        orientation: 'vertical'
                        size_hint_x: 1
                        spacing: dp(15)
                        size_hint_y: None
                        height: self.minimum_height

                        BoxLayout:
                            orientation: 'vertical'
                            spacing: dp(15)
                            canvas.before:
                                Color:
                                    rgba: 0.97, 0.97, 0.97, 1
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(12), dp(12), dp(12), dp(12)]
                            padding: [dp(15), dp(15), dp(15), dp(15)]

                            # Seção do Acorde Selecionado - Modificada para layout horizontal
                            BoxLayout:
                                orientation: 'horizontal'
                                size_hint_y: None
                                height: dp(80)  # Altura fixa para a linha
                                spacing: dp(15)

                                # Área do acorde selecionado
                                ScrollView:
                                    scroll_type: ['bars', 'content']
                                    bar_width: dp(8)
                                    bar_color: 0.1, 0.5, 0.8, 0.7
                                    canvas.before:
                                        Color:
                                            rgba: 0.96, 0.96, 0.96, 1
                                        RoundedRectangle:
                                            pos: self.pos
                                            size: self.size
                                            radius: [dp(10), dp(10), dp(10), dp(10)]
                            
                                    Label:
                                        id: selected_chord_label
                                        text: "[i]Clique em um acorde da lista para ver detalhes[/i]"
                                        markup: True
                                        font_size: '15sp'
                                        text_size: self.width - dp(20), None
                                        size_hint_y: None
                                        height: max(self.texture_size[1], dp(80))
                                        halign: 'left'
                                        valign: 'center'  # Alterado para center para melhor alinhamento
                                        padding: [dp(12), dp(12), dp(12), dp(12)]
                                        color: 0.4, 0.4, 0.4, 1

                    # Seção dos Controles de Metadados
                    BoxLayout:
                        orientation: 'vertical'
                        size_hint_y: None
                        height: dp(60)  # Altura fixa suficiente

                        Button:
                            text: "ATUALIZAR METADADOS DO ACORDE"
                            font_size: '15sp'
                            background_normal: ''
                            background_color: 0.2, 0.75, 0.45, 1
                            color: 1, 1, 1, 1
                            bold: True
                            size_hint_y: None
                            height: dp(60)
                            on_release: root.update_metadata()
                            canvas.before:
                                Color:
                                    rgba: self.background_color
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(10), dp(10), dp(10), dp(10)]