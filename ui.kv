<HarmonyScreen>:
    orientation: 'horizontal'
    padding: 0
    spacing: 0
    canvas.before:
        Color:
            rgba: 0.94, 0.96, 0.98, 1  # Fundo mais suave
        Rectangle:
            pos: self.pos
            size: self.size

    # Painel principal (70% da largura)
    BoxLayout:
        orientation: 'vertical'
        size_hint_x: 0.7
        spacing: 0
        padding: 0

        # Header com informações do projeto
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: None
            height: 160
            spacing: 0
            padding: 0
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
                # Sombra sutil
                Color:
                    rgba: 0.85, 0.85, 0.85, 0.3
                Rectangle:
                    pos: self.x, self.y - 2
                    size: self.width, 2

            # Adicione o widget Image aqui, por exemplo:
            Image:
                source: 'assets/harmonauta_logo.png'
                size_hint_y: None
                height: 50
                fit_mode: 'contain'
                padding: 10, 0, 10, 0

            # Título da seção
            Label:
                text: "INFORMAÇÕES DO PROJETO"
                size_hint_y: None
                height: 35
                font_size: '14sp'
                bold: True
                color: 0.2, 0.2, 0.2, 1
                halign: 'left'
                padding: 15, 0
                text_size: self.width, None
                canvas.before:
                    Color:
                        rgba: 0.96, 0.97, 0.98, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size

            # Campos de entrada em grid
            GridLayout:
                cols: 3
                size_hint_y: None
                height: 70
                padding: 15, 10, 15, 10
                spacing: 15

                # Campo Título
                BoxLayout:
                    orientation: 'vertical'
                    spacing: 5
                    
                    Label:
                        text: "Título"
                        size_hint_y: None
                        height: 20
                        font_size: '12sp'
                        color: 0.4, 0.4, 0.4, 1
                        halign: 'left'
                        text_size: self.width, None
                    
                    TextInput:
                        id: project_title_input
                        hint_text: "Digite o título da música"
                        hint_text_color: 0.6, 0.6, 0.6, 1
                        font_size: 14
                        multiline: False
                        foreground_color: 0.2, 0.2, 0.2, 1
                        background_color: 0.98, 0.98, 0.98, 1
                        cursor_color: 0.2, 0.5, 0.8, 1
                        padding: 10, 8
                        size_hint_y: None
                        height: 35
                        on_text_validate: root.ids.project_description_input.focus = True

                # Campo Compositor
                BoxLayout:
                    orientation: 'vertical'
                    spacing: 5
                    
                    Label:
                        text: "Compositor"
                        size_hint_y: None
                        height: 20
                        font_size: '12sp'
                        color: 0.4, 0.4, 0.4, 1
                        halign: 'left'
                        text_size: self.width, None
                    
                    TextInput:
                        id: project_description_input
                        hint_text: "Nome do compositor"
                        hint_text_color: 0.6, 0.6, 0.6, 1
                        font_size: 14
                        multiline: False
                        foreground_color: 0.2, 0.2, 0.2, 1
                        background_color: 0.98, 0.98, 0.98, 1
                        cursor_color: 0.2, 0.5, 0.8, 1
                        padding: 10, 8
                        size_hint_y: None
                        height: 35
                        on_text_validate: root.ids.project_key_input.focus = True

                # Campo Tonalidade
                BoxLayout:
                    orientation: 'vertical'
                    spacing: 5
                    
                    Label:
                        text: "Tonalidade"
                        size_hint_y: None
                        height: 20
                        font_size: '12sp'
                        color: 0.4, 0.4, 0.4, 1
                        halign: 'left'
                        text_size: self.width, None
                    
                    TextInput:
                        id: project_key_input
                        hint_text: "Ex: Am, C"
                        hint_text_color: 0.6, 0.6, 0.6, 1
                        multiline: False
                        font_size: 14
                        foreground_color: 0.2, 0.2, 0.2, 1
                        background_color: 0.98, 0.98, 0.98, 1
                        cursor_color: 0.2, 0.5, 0.8, 1
                        padding: 10, 8
                        size_hint_y: None
                        height: 35
                        on_text_validate: root.ids.lyrics_input.focus = True

            # Barra de ações
            BoxLayout:
                size_hint_y: None
                height: 55
                spacing: 10
                padding: 15, 10, 15, 15

                Button:
                    text: "SALVAR"
                    background_normal: ''
                    background_color: 0.2, 0.6, 0.35, 1
                    color: 1, 1, 1, 1
                    bold: True
                    font_size: '13sp'
                    size_hint_x: 0.25
                    canvas.before:
                        Color:
                            rgba: 0.2, 0.6, 0.35, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [4, 4, 4, 4]
                    on_press: root.save_project()

                Button:
                    text: "CARREGAR"
                    background_normal: ''
                    background_color: 0.2, 0.5, 0.8, 1
                    color: 1, 1, 1, 1
                    bold: True
                    font_size: '13sp'
                    size_hint_x: 0.25
                    canvas.before:
                        Color:
                            rgba: 0.2, 0.5, 0.8, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [4, 4, 4, 4]
                    on_press: root.load_project()

                Button:
                    text: "BUSCAR LETRA"
                    background_normal: ''
                    background_color: 0.8, 0.5, 0.2, 1
                    color: 1, 1, 1, 1
                    bold: True
                    font_size: '13sp'
                    size_hint_x: 0.25
                    canvas.before:
                        Color:
                            rgba: 0.8, 0.5, 0.2, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [4, 4, 4, 4]
                    on_press: root.fetch_lyrics_from_letras()

                Button:
                    text: "RESETAR"
                    background_normal: ''
                    background_color: 0.8, 0.3, 0.3, 1
                    color: 1, 1, 1, 1
                    bold: True
                    font_size: '13sp'
                    size_hint_x: 0.25
                    canvas.before:
                        Color:
                            rgba: 0.8, 0.3, 0.3, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [4, 4, 4, 4]
                    on_press: root.reset_all_fields()

        # Seção de edição da letra
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: 0.4
            spacing: 0
            padding: 0

            # Título da seção
            Label:
                text: "EDIÇÃO DA LETRA"
                size_hint_y: None
                height: 35
                font_size: '14sp'
                bold: True
                color: 0.2, 0.2, 0.2, 1
                halign: 'left'
                padding: 15, 0
                text_size: self.width, None
                canvas.before:
                    Color:
                        rgba: 0.96, 0.97, 0.98, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size

            # Área de texto
            BoxLayout:
                orientation: 'vertical'
                padding: 15, 10, 15, 0
                spacing: 10

                TextInput:
                    id: lyrics_input
                    hint_text: "Digite ou cole a letra com acordes no formato [Am]"
                    hint_text_color: 0.6, 0.6, 0.6, 1
                    multiline: True
                    font_size: 15
                    foreground_color: 0.2, 0.2, 0.2, 1
                    background_color: 0.98, 0.98, 0.98, 1
                    cursor_color: 0.2, 0.5, 0.8, 1
                    padding: 15, 10
                    on_text: root.on_text_change(*args)

                # Inserção de acordes
                BoxLayout:
                    size_hint_y: None
                    height: 45
                    spacing: 10

                    TextInput:
                        id: chord_input
                        hint_text: "Acorde (ex: Am, C7)"
                        hint_text_color: 0.6, 0.6, 0.6, 1
                        multiline: False
                        font_size: 14
                        foreground_color: 0.2, 0.2, 0.2, 1
                        background_color: 0.98, 0.98, 0.98, 1
                        cursor_color: 0.2, 0.5, 0.8, 1
                        padding: 10, 8
                        on_text_validate: root.insert_chord_tag()

                    Button:
                        text: "Inserir Acorde"
                        size_hint_x: 0.3
                        background_normal: ''
                        background_color: 0.2, 0.5, 0.8, 1
                        color: 1, 1, 1, 1
                        bold: True
                        font_size: '13sp'
                        canvas.before:
                            Color:
                                rgba: 0.2, 0.5, 0.8, 1
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [4, 4, 4, 4]
                        on_press: root.insert_chord_tag()

        # Seção de pré-visualização
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: 0.45
            spacing: 0
            padding: 0

            # Painel da cifra
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: 0.6
                spacing: 0
                canvas.before:
                    Color:
                        rgba: 1, 1, 1, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size

                # Cabeçalho da cifra
                Label:
                    text: "CIFRA"
                    size_hint_y: None
                    height: 40
                    font_size: '14sp'
                    bold: True
                    color: 0.2, 0.2, 0.2, 1
                    halign: 'left'
                    padding: 15, 0
                    text_size: self.width, None
                    canvas.before:
                        Color:
                            rgba: 0.94, 0.96, 0.98, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size

                # Área de visualização da cifra
                ScrollView:
                    bar_width: 8
                    bar_color: 0.2, 0.5, 0.8, 0.6
                    bar_inactive_color: 0.2, 0.5, 0.8, 0.3
                    do_scroll_x: False

                    Label:
                        id: cifra_preview
                        markup: True
                        text_size: self.width, None
                        size_hint_y: None
                        height: self.texture_size[1]
                        font_size: 15
                        padding: 15, 15
                        halign: 'left'
                        valign: 'top'
                        color: 0.2, 0.2, 0.2, 1

            # Separador vertical
            Widget:
                size_hint_x: None
                width: 1
                canvas.before:
                    Color:
                        rgba: 0.9, 0.9, 0.9, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size

            # Painel de análise
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: 0.4
                spacing: 0
                canvas.before:
                    Color:
                        rgba: 1, 1, 1, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size

                # Cabeçalho da análise
                Label:
                    text: "ANÁLISE HARMÔNICA"
                    size_hint_y: None
                    height: 40
                    font_size: '14sp'
                    bold: True
                    color: 0.2, 0.2, 0.2, 1
                    halign: 'left'
                    padding: 15, 0
                    text_size: self.width, None
                    canvas.before:
                        Color:
                            rgba: 0.94, 0.96, 0.98, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size

                # Área de análise
                ScrollView:
                    bar_width: 8
                    bar_color: 0.2, 0.5, 0.8, 0.6
                    bar_inactive_color: 0.2, 0.5, 0.8, 0.3
                    do_scroll_x: False

                    Label:
                        id: metadata_preview
                        markup: True
                        text_size: self.width, None
                        size_hint_y: None
                        height: self.texture_size[1]
                        font_size: 13
                        padding: 15, 15
                        halign: 'left'
                        valign: 'top'
                        color: 0.2, 0.2, 0.2, 1

    # Separador vertical principal
    Widget:
        size_hint_x: None
        width: 2
        canvas.before:
            Color:
                rgba: 0.85, 0.85, 0.85, 1
            Rectangle:
                pos: self.pos
                size: self.size

    # Painel lateral de acordes (30% da largura)
    BoxLayout:
        orientation: 'vertical'
        size_hint_x: 0.3
        spacing: 0
        padding: 0
        canvas.before:
            Color:
                rgba: 0.98, 0.98, 0.99, 1
            Rectangle:
                pos: self.pos
                size: self.size

        # Cabeçalho dos acordes
        Label:
            text: "ACORDES NA MÚSICA"
            font_size: '14sp'
            size_hint_y: None
            height: 40
            bold: True
            color: 0.2, 0.2, 0.2, 1
            halign: 'left'
            padding: 15, 0
            text_size: self.width, None
            canvas.before:
                Color:
                    rgba: 0.94, 0.96, 0.98, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        # Lista de acordes
        ScrollView:
            size_hint_y: 0.35
            bar_width: 8
            bar_color: 0.2, 0.5, 0.8, 0.6
            bar_inactive_color: 0.2, 0.5, 0.8, 0.3
            do_scroll_x: False

            GridLayout:
                id: chord_list
                cols: 1
                size_hint_y: None
                height: self.minimum_height
                spacing: 2
                padding: 10

        # Informações do acorde selecionado
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: None
            height: 80
            padding: 15, 10
            spacing: 10

            Label:
                text: "ACORDE SELECIONADO"
                size_hint_y: None
                height: 20
                font_size: '12sp'
                bold: True
                color: 0.4, 0.4, 0.4, 1
                halign: 'left'
                text_size: self.width, None

            Label:
                id: selected_chord_label
                text: "[i]Nenhum acorde selecionado[/i]"
                markup: True
                size_hint_y: None
                height: 25
                font_size: '14sp'
                color: 0.2, 0.2, 0.2, 1
                halign: 'left'
                text_size: self.width, None

        # Campos de análise
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: 0.4
            padding: 15, 10
            spacing: 15

            # Campo grau harmônico
            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: 70
                spacing: 5

                Label:
                    text: "Grau Harmônico"
                    size_hint_y: None
                    height: 20
                    font_size: '12sp'
                    color: 0.4, 0.4, 0.4, 1
                    halign: 'left'
                    text_size: self.width, None

                TextInput:
                    id: degree_input
                    hint_text: "Ex: I, ii, V7, vi"
                    hint_text_color: 0.6, 0.6, 0.6, 1
                    size_hint_y: None
                    height: 40
                    multiline: False
                    font_size: 14
                    foreground_color: 0.2, 0.2, 0.2, 1
                    background_color: 0.98, 0.98, 0.98, 1
                    cursor_color: 0.2, 0.5, 0.8, 1
                    padding: 10, 8

            # Campo comentário
            BoxLayout:
                orientation: 'vertical'
                spacing: 5

                Label:
                    text: "Análise/Comentário"
                    size_hint_y: None
                    height: 20
                    font_size: '12sp'
                    color: 0.4, 0.4, 0.4, 1
                    halign: 'left'
                    text_size: self.width, None

                TextInput:
                    id: comment_input
                    hint_text: "Adicione suas observações..."
                    hint_text_color: 0.6, 0.6, 0.6, 1
                    multiline: True
                    font_size: 14
                    foreground_color: 0.2, 0.2, 0.2, 1
                    background_color: 0.98, 0.98, 0.98, 1
                    cursor_color: 0.2, 0.5, 0.8, 1
                    padding: 10, 8

        # Botões de ação
        BoxLayout:
            size_hint_y: None
            height: 50
            spacing: 10
            padding: 15, 0, 15, 15

            Button:
                text: "Atualizar"
                background_normal: ''
                background_color: 0.2, 0.6, 0.35, 1
                color: 1, 1, 1, 1
                bold: True
                font_size: '13sp'
                canvas.before:
                    Color:
                        rgba: 0.2, 0.6, 0.35, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [4, 4, 4, 4]
                on_press: root.update_metadata()

            Button:
                text: "Limpar"
                background_normal: ''
                background_color: 0.8, 0.3, 0.3, 1
                color: 1, 1, 1, 1
                bold: True
                font_size: '13sp'
                canvas.before:
                    Color:
                        rgba: 0.8, 0.3, 0.3, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [4, 4, 4, 4]
                on_press: root.clear_metadata_fields()